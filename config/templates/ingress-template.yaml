apiVersion: networking.k8s.io/v1
kind: Ingress  # æŒ‡å®šèµ„æºçš„ç±»å‹ï¼Œè¿™é‡Œæ˜¯ Ingressï¼Œç”¨äºç®¡ç† HTTP å’Œ HTTPS çš„æµé‡è§„åˆ™ã€‚
metadata:
  name: { { APP_NAME } }-ingress
  namespace: default
  annotations:
    alb.ingress.kubernetes.io/scheme: internet-facing  # æŒ‡å®š ALB çš„ç±»å‹ï¼Œè¿™é‡Œæ˜¯ internet-facingï¼Œè¡¨ç¤º ALB å°†å…¬å¼€å¯è®¿é—®ã€‚
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS": 443}]'  # ç›‘å¬ 80 å’Œ 443 ç«¯å£ (HTTPS)
    alb.ingress.kubernetes.io/ssl-cert: arn:aws:acm:{ { AWS_REGION } }:{ { AWS_ACCOUNT_ID } }:certificate/{ { CERTIFICATE_ID } }  # æŒ‡å®šè¯ä¹¦ ARN
    alb.ingress.kubernetes.io/backend-protocol: HTTP
    alb.ingress.kubernetes.io/target-type: ip  # æŒ‡å®šç›®æ ‡ç±»å‹ä¸º IPï¼Œè¡¨ç¤º ALB å°†ç›´æ¥è·¯ç”±åˆ° Pod çš„ IP åœ°å€ï¼Œè€Œä¸æ˜¯é€šè¿‡ NodePort æˆ– ClusterIPã€‚
    alb.ingress.kubernetes.io/healthcheck-path: /healthz
    alb.ingress.kubernetes.io/healthcheck-port: "80"
    alb.ingress.kubernetes.io/success-codes: "200"
spec:
  # æŒ‡å®šä½¿ç”¨çš„ Ingress ç±»ï¼Œè¿™é‡Œæ˜¯ albï¼Œè¡¨ç¤ºä½¿ç”¨ ALB æ¥ä½œä¸ºå…¥å£æµé‡çš„è´Ÿè½½å‡è¡¡å™¨ã€‚
  ingressClassName: alb  # ğŸ‘ˆ å…³é”®
  rules:
    - host: { { URL } }  # æŒ‡å®šä¸»æœºåï¼ŒALB å°†æ ¹æ®è¿™ä¸ªä¸»æœºåæ¥è·¯ç”±æµé‡ã€‚
      http:
        paths: # Ingress çš„è§„åˆ™ï¼Œå®šä¹‰äº†è·¯ç”±æµé‡çš„è§„åˆ™ã€‚
          - path: /
            pathType: Prefix
            backend: # é…ç½®å¦‚ä½•è½¬å‘åŒ¹é…åˆ°çš„æµé‡ã€‚
              service:
                name: { { APP_NAME } }  # æŒ‡å®šåç«¯æœåŠ¡çš„åç§°ï¼Œè¿™é‡Œæ˜¯ä¹‹å‰åˆ›å»ºçš„ Service çš„åç§°ã€‚
                port:
                  number: 80
  tls:
    - hosts:
        - { { URL } }  # æŒ‡å®šä¸»æœºåï¼ŒALB å°†æ ¹æ®è¿™ä¸ªä¸»æœºåæ¥è·¯ç”±æµé‡ã€‚
      secretName: dummy-secret # ç”¨äºè§¦å‘ TLS blockï¼ŒACM è¯ä¹¦ä¸éœ€çœŸæ­£å­˜åœ¨æ­¤ Secret
